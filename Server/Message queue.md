# Message queue
MOM(Message Oriented Middleware)을 구현한 시스템을 메시지 큐(MQ)라고 한다. 메시지 큐는 별도의 공정 작업을 연기할 수 있는 유연성을 제공하여 SOA(Service-Oriendted Architecture)방식의 개발에 도움을 줄 수 있다.  
  
프로그래밍에서 MQ는 프로세스 또는 프로그램 인스턴스가 데이터를 서로 교환할때 사용하는 방법이다. 서로 다른 프로세스나 프로그램 사이에 메시지를 교환할때 AMQP(Advanced Message Queueing Protocol)을 이용한다. AMQP는 메세지 지향 미들웨어를 위한 open standard application layer protocol 이다. AMQP를 이용하면 다른 벤더 사이에 메세지를 전송하는 것이 가능하다.  

![Message Queue basic process](https://github.com/mataeLee/Study-Tech/blob/master/resource/mq%20process.png)
기본적인 원리는 다음과 같다.  
Producer가 메시지를 큐에 넣어두면, Consumer가 메시지를 가져와 처리하는 방식이다.

클라이언트와 동기방식으로 많은 데이터 통신을 하게 되면 병목현상이 생기게되고, 서버의 성능이 저하될 가능성이 있다.  이런 현상을 방지하기 위하여 미들웨어를 두어 메시지를 위임하고, 순차적으로 처리를 하는 구조를 갖는다.
  
## Why?
대용량 데이터를 처리하기 위한 배치 작업이나, 채팅 서비스, 비동기 데이터 처리, 어플리케이션/시스템간 통신 등에 사용된다. 프로세스 단위로 처리하는 웹 요청이나 일반적인 프로그램을 만들어서 사용하는데, 사용자가 많아지거나 데이터가 많아지면 요청에 대한 응답이 지연되므로 서비스가 정상적으로 작동하지 못하는 상황이 올 수 있다. 따라서 기존에 분산되어 있던 데이터 처리를 한곳으로 집중시키고. 브로커를 두어 작업을 분산 시키는 방법을 적용하기 위해 사용한다.    

## Pros & Cons
__Pros__
- 비동기(Asynchronous): Queue에 넣기 때문에 나중에 처리 할 수 있다.
- 비동조(Decoupling): 어플리케이션과 분리 할 수 있다.
- 탄력성(Resilience): 일부가 실패 시 전체에 영향을 받지 않는다.
- 과잉(Redundancy): 실패 할 경우 재실행이 가능하다.
- 보증(Guarantees): 작업이 처리된 걸 확인 할 수 있다.
- 확장성(Scalable): 다수의 프로세스들이 큐에 메시지를 보낼 수 있다.  

__Cons__
- 큐를 운영하기 위한 추가적인 자원 필요.
- 큐를 이용함에 따라 오버헤드 발생 가능성 있음.
- 시스템 목적에 맞는 MQ선정과 서버에 설치 필요.
- 선정된 MQ의 사용 방법 및 라이브러리 사용법도 익혀야 하고, 메시지 구조도 정의해야 한다.
- 즉각적인 서비스가 불가능하다.

## Kind
__오픈소스 메시지 큐(특징만 간단하게 정리 하였음)__
- __RabbitMQ__
    * AMQT 프로토콜을 구현해 놓은 프로그램이다.
    * 로컬 네트워크레 있는 여러 RabbitMQ 서버를 논리적으로 클러스터링 할 수 있고 논리적인 브로커도 가능하다.  
    * MQ가 도착하기 전에 라우팅되며 플러그인을 통해 더 복잡한 라우팅도 가능하다.  
  
- __ActiveMQ__
    * JMS 클라이언트와 함께 자바로 만든 오픈소스 메시지 브로커다.
    * 엔터프라이즈 기능을 제공한다. (하나 이상의 클라이언트와 서버간의 커뮤니케이션 증진시키는 기능)
    * REST API를 통한 웹기반 메시징 API를 지원한다.  
  
- __ZeroMQ__
    * 메시징 라이브러리이다.
    * 복잡한 커뮤니케이션 시스템을 설계하기 편리하다.
    * '메시징 미들웨어'로 시작하여 '스테로이드를 맞은 TCP', 후에는 '네트워크 스택의 새로운 레이어'로의 변천사가 있다.
    * 대부분의 AMQP들 보다 속도가 있다. 신뢰성있는 멀티캐스트나 Y-suit IPC같이 효율적인 전송을 활용하기 떄문이다.
    * 단순한 API를 보유했다.  
  
- __Kafka__
    * 대용량 실시간 로그 처리에 특화되어 설계된 메시징 시스템이다.
    * 분산 시스템을 기본으로 설계되었기 때문에, 분산 및 복제 구성을 쉽게 할 수 있다.
    * 파일시스템에 메시지를 저장하기 때문에 데이터의 영속성이 보존된다.
    * consumer가 borker로부터 직접 메시지를 가지고 가는 pull 방식으로 동작한다.  
  
## Reference
- https://kji6252.github.io/2015/12/18/message-quere/
- https://shortstories.gitbooks.io/studybook/content/message_queue_c815_b9ac.html
- https://heowc.tistory.com/35
